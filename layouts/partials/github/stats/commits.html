{{- $username := . -}}
{{- if not $username -}}
    {{ errorf "Input must be a GitHub username: %s" .Position }}
{{- end -}}

{{- $githubApiUrl := "https://api.github.com/" -}}
{{- $githubHeaders := dict "Accept" "application/vnd.github.v3+json" -}}
{{- if in $username ":" -}}
    {{- $githubAuthorization := print "Basic " (base64Encode $username) -}}
    {{- $githubHeaders = merge $githubHeaders (dict "Authorization" $githubAuthorization) -}}
    {{- $username = index (split $username ":") 0 -}}
{{- end -}}

{{- $userData := getJSON $githubApiUrl "users/" $username $githubHeaders -}}
{{- $ownedReposData := getJSON $userData.repos_url "?per_page=100&type=owner" $githubHeaders -}}
{{- $memberReposData := getJSON $userData.repos_url "?per_page=100&type=member" $githubHeaders -}}
{{- $reposData := append $ownedReposData $memberReposData -}}

{{/* Count stargazers. */}}
{{- $commits := 0 -}}
{{- range $reposData -}}
    {{- $contributorsData := getJSON .url "/stats/contributors?1" $githubHeaders -}}
    {{- range $contributorsData -}}
        {{- if eq .author.login $username -}}
            {{- $commits = add $commits .total -}}
        {{- end -}}
    {{- end -}}
{{- end -}}

{{- $commits | lang.FormatNumber 0 -}}

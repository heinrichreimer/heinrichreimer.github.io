{{- $username := . -}}
{{- if not $username -}}
    {{ errorf "Input must be a GitHub username: %s" .Position }}
{{- end -}}

{{- $githubApiUrl := "https://api.github.com/" -}}
{{- $githubHeaders := dict "Accept" "application/vnd.github.v3+json" -}}

{{- $userData := getJSON $githubApiUrl "users/" $username $githubHeaders -}}
{{- $ownedReposData := getJSON $userData.repos_url "?per_page=100&type=owner" (dict "Accept" "application/vnd.github.v3+json") -}}
{{- $memberReposData := getJSON $userData.repos_url "?per_page=100&type=member" (dict "Accept" "application/vnd.github.v3+json") -}}
{{- $reposData := append $ownedReposData $memberReposData -}}

{{- $licenseData := getJSON "https://github.com/spdx/license-list-data/raw/master/json/licenses.json" -}}
{{- $osiApprovedLicenses := slice -}}
{{- range  (where $licenseData.licenses "isOsiApproved" true) -}}
{{- $osiApprovedLicenses = append .licenseId $osiApprovedLicenses -}}
{{- end -}}

{{- $openSourceRepos := 0 -}}

{{- range $reposData -}}
{{- with .license -}}
{{- if in $osiApprovedLicenses .spdx_id -}}
{{- $openSourceRepos = add $openSourceRepos 1 -}}
{{- end -}}
{{- end -}}
{{- end -}}

{{- $openSourceRepos -}}
